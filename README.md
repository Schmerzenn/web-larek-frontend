# Проектная работа "Веб-ларек"

https://github.com/Schmerzenn/web-larek-frontend

## Описание

В проекте применён паттерн MVP (Model–View–Presenter), обеспечивающий чёткое разделение ответственностей и слабую связанность компонентов. Каждый слой выполняет строго определённую роль:

Model — отвечает за работу с данными. Загружает их через API, обрабатывает, хранит и предоставляет бизнес-логику. Также принимает данные, введённые пользователем (например, адрес, e-mail и содержимое корзины).

View — отображает интерфейс для взаимодействия с пользователем: карточки товаров, формы, кнопки. Обрабатывает пользовательские действия (клики, ввод данных) и генерирует события, не содержащие логики.

Presenter — реализован через EventEmitter (брокер событий) и вспомогательные классы, которые подписаны на события от View и от Model. Именно Presenter координирует поток данных и управляет связью между слоями. Он обрабатывает события, полученные от View, обновляет Model и триггерит обновление View, если данные изменились.

## Стек

```
HTML, SCSS, TS, Webpack
```

## Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

# Документация

### Класс `Api`

Содержит свойства и методы для взаимодействия с сервером:

- **Метод** `handleResponse(response: Response): Promise<object>`  
  Обрабатывает ответ от сервера и возвращает распарсенный объект.

- **Метод** `get(uri: string)`  
  Принимает изменяемую часть URL и возвращает промис с ответом сервера.

- **Метод** `post(uri: string, data: object, method: ApiPostMethods = 'POST')`  
  Отправляет на сервер объект `data` по указанному URI, используя один из HTTP‑методов: `'POST' | 'PUT' | 'DELETE'`.

---

### Класс `EventEmitter` implements `IEvents`

Реализует паттерн «Наблюдатель» для управления событиями. Позволяет подписываться на них, отписываться и генерировать:

- **`on(event: string, listener: Function)`**  
  Подписка на конкретное событие.

- **`off(event: string, listener: Function)`**  
  Отмена подписки на событие.

- **`emit(event: string, ...args: any[])`**  
  Оповещение подписчиков о наступлении события.

- **`onAll(listener: Function)`**  
  Подписка на все виды событий.

- **`offAll()`**  
  Сброс всех подписчиков.

- **`trigger(event: string, ...args: any[])`**  
  Генерация заданного события с аргументами, что позволяет передавать метод в качестве обработчика другим классам без прямой зависимости.

---

## Классы моделей (`Model`)

Отвечают за хранение и обработку данных из сервера и от пользователя.

#### `ApiModel` extends `Api`

Обменивается данными с сервером:

- **`getListProductCard(): Promise<ProductCard[]>`**  
  Запрашивает массив карточек товаров.

- **`postOrderLot(): Promise<object>`**  
  Отправляет на сервер заказ и получает подтверждение.

#### `BasketModel`

Управляет данными корзины, введёнными пользователем:

- **`getCounter(): number`**  
  Возвращает количество товаров в корзине.

- **`getSumAllProducts(): number`**  
  Суммирует стоимость всех товаров в корзине.

- **`setSelectedСard(card: ProductCard)`**  
  Добавляет товар в корзину.

- **`deleteCardToBasket(cardId: string)`**  
  Удаляет указанный товар из корзины.

- **`clearBasketProducts()`**  
  Очищает корзину полностью.

#### `DataModel`

Хранит данные о продуктах, полученные с сервера:

- **`setPreview(card: ProductCard)`**  
  Сохраняет информацию о товаре для просмотра.

#### `FormModel`

Собирает и проверяет данные, введённые пользователем:

- **`setOrderAddress(address: string)`**  
  Сохраняет адрес доставки.

- **`validateOrder(): boolean`**  
  Проверяет корректность адреса и способа оплаты.

- **`setOrderData(contact: { phone?: string; email?: string })`**  
  Сохраняет телефон и/или email пользователя.

- **`validateContacts(): boolean`**  
  Проверяет формат телефона и почты.

- **`getOrderLot(): OrderData`**  
  Возвращает объект с данными пользователя и выбранными товарами.

---

## Классы представления (`View`)

Отображают элементы страницы и обрабатывают взаимодействие с пользователем.

#### `Basket`

Управляет визуализацией корзины:

- **`renderHeaderBasketCounter(count: number)`**  
  Обновляет счётчик количества товаров в шапке.

- **`renderSumAllProducts(sum: number)`**  
  Отображает общую стоимость товаров.

#### `BasketItem`

Отвечает за отображение отдельного товара в корзине:

- **`setPrice(price: number): string`**  
  Преобразует число в строку для вывода цены.

#### `Card`

Рендерит карточку товара на странице:

- **`setText(element: HTMLElement, text: string)`**  
  Устанавливает текстовое содержимое элемента.

- **`cardCategory(category: string)`**  
  Добавляет соответствующий `className` к элементу.

- **`setPrice(price: number): string`**  
  Форматирует числовое значение цены в строку.

#### `CardPreview` extends `Card`

Отвечает за подробный просмотр товара и добавление в корзину:

- **`notSale(product: ProductCard)`**  
  Проверяет наличие цены и, если она отсутствует, блокирует возможность покупки.

#### `Order`

Управляет модальным окном выбора оплаты:

- **`paymentSelection(method: string)`**  
  Подсвечивает выбранный способ оплаты.

#### `Contacts`

Отображает модалку для ввода телефона и email.

#### `Modal`

Управляет открытием и закрытием модальных окон:

- **`open()`** — открывает окно.
- **`close()`** — закрывает окно.

#### `Success`

Показывает модальное окно с подтверждением успешного оформления заказа.
